import"vue-tsx-support/enable-check";import*as t from"vue-tsx-support";import{VueEditor as e,NODE_TO_KEY as n,EDITOR_TO_GVM as r,withVue as o,GVM_TO_EDITOR as i,EDITOR_TO_ON_CHANGE as a,PLACEHOLDER_SYMBOL as s,KEY_TO_ELEMENT as c,NODE_TO_ELEMENT as u,ELEMENT_TO_NODE as l,NODE_TO_INDEX as d,NODE_TO_PARENT as f,KEY_TO_VNODE as h,EditableComponent as p,IS_READ_ONLY as m,IS_FIREFOX as v,IS_EDGE_LEGACY as g,EDITOR_TO_ELEMENT as y,addOnBeforeInput as b}from"slate-vue-shared";export{VueEditor}from"slate-vue-shared";import _ from"vue";import{Transforms as S,Text as $,Node as O,Path as x,Editor as C,createEditor as w,Range as E,Element as k}from"slate";import j from"direction";var B=null,D=!1,F=0;function N(){if(!B)throw new Error("invalid hooks call: hooks can only be called in a function passed to withHooks.")}function P(t){return t._isVue?t.$el:t}function A(t,e){N();var n=++F;if(D){var r=function t(){var e=t.current;e&&(e(),t.current=null)},o=function t(){var e=t.current;e&&(r.current=e.call(this),t.current=null)};o.current=t,B._effectStore[n]={effect:o,cleanup:r,deps:e},B.$on("hook:mounted",o),B.$on("hook:destroyed",r),(!e||e.length>0)&&B.$on("hook:updated",o)}else{var i=B._effectStore[n],a=i.effect,s=i.cleanup,c=i.deps,u=void 0===c?[]:c;i.deps=e,e&&!e.some((function(t,e){return t!==u[e]}))||(s(),a.current=t)}}function L(t){N();var e=(++F).toString(),n=B._refsStore;return B.$on("hook:mounted",(function(){this.$refs[e]&&(n[e].current=P(this.$refs[e]))})),B.$on("hook:updated",(function(){this.$refs[e]&&(n[e].current=P(this.$refs[e]))})),D?n[e]={current:t,id:e}:n[e]}function T(t){t.mixin({beforeCreate:function(){var t=this.$options,e=t.hooks,n=t.data;e&&(this._effectStore={},this._refsStore={},this._computedStore={},this.$options.data=function(){var t=n?n.call(this):{};return t._state={},t})},beforeMount:function(){var t=this.$options,e=t.hooks,n=t.render;e&&n&&(this.$options.render=function(t){F=0,B=this,D=!this._vnode;var r=e.call(this,this.$props);Object.assign(this._self,r);var o=n.call(this,t);return B=null,o})}})}function I(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function J(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){I(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function K(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var R,U=function(t){return C.isEditor(t)?t._state:t.children},q=function(t,e){if($.isText(t))throw new Error("Cannot get the child of a text node: ".concat(JSON.stringify(t)));var n=U(t)[e];if(null==n)throw new Error("Cannot get child at index `".concat(e,"` in node: ").concat(JSON.stringify(t)));return n},V=function(t,e){for(var n=t,r=0;r<e.length;r++){var o=e[r],i=U(n);if($.isText(n)||!i[o])return!1;n=i[o]}return!0},W=function(t,e){for(var n=t,r=0;r<e.length;r++){var o=e[r],i=U(n);if($.isText(n)||!i[o])throw new Error("Cannot find a descendant at path [".concat(e,"] in node: ").concat(JSON.stringify(t)));n=i[o]}return n},H=function(t,e){for(var n=e.slice(),r=O.get(t,n),o=U(r);r&&!$.isText(r)&&0!==o.length;)r=o[0],n.push(0);return[r,n]},G=function(t,e){for(var n=e.slice(),r=O.get(t,n),o=U(r);r&&!$.isText(r)&&0!==o.length;){var i=o.length-1;r=o[i],n.push(i)}return[r,n]},Q=function*(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.pass,r=e.reverse,o=void 0!==r&&r,i=e.from,a=void 0===i?[]:i,s=e.to,c=new Set,u=[],l=t;!s||!(o?x.isBefore(u,s):x.isAfter(u,s));)if(c.has(l)||(yield[l,u]),c.has(l)||$.isText(l)||0===U(l).length||null!=n&&!1!==n([l,u])){if(0===u.length)break;if(!o){var d=x.next(u);if(O.has(t,d)){u=d,l=O.get(t,u);continue}}if(o&&0!==u[u.length-1]){var f=x.previous(u);u=f,l=O.get(t,u)}else u=x.parent(u),l=O.get(t,u),c.add(l)}else{c.add(l);var h=o?U(l).length-1:0;x.isAncestor(u,a)&&(h=a[u.length]),u=u.concat(h),l=O.get(t,u)}},X=(R=S.select,S.select=function(t,e){var n;return e.__ob__&&(n=e,e=JSON.parse(JSON.stringify(n))),R(t,e)},S),Y=function(){var t=O.get,e=O.nodes,n=O.has,r=O.first,o=O.child,i=O.last;return O.child=q,O.has=V,O.get=W,O.first=H,O.last=G,O.nodes=Q,function(){O.get=t,O.nodes=e,O.has=n,O.first=r,O.child=o,O.last=i}},Z=function(t){return function(){var e=Y(),n=t.apply(void 0,arguments);return e(),n}},tt=function(t){for(var e=Y(),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=t.apply(void 0,r);return e(),i};e.toDOMRange=Z(e.toDOMRange);var et=function(t){return r.get(t)},nt=function(t,e){var n=t._watcher.update;t._watcher.update=function(){var r=t.$editor._operation;if(r){if("remove_text"===r.type||"insert_text"===r.type||"set_selection"===r.type)return;if("remove_node"===r.type&&"element"===e)return}n.call(t._watcher)}},rt=t.component({mounted:function(){this.$editor._state.__ob__.dep.addSub(this._watcher)}}),ot=t.component({created:function(){var t=et(this.$editor),e=this.element||this.node;t.selected.elements.push(e)},computed:{selected:function(){if(this.element){var t=et(this.$editor),e=n.get(this.element);return!!e&&t.selected[e.id]}return!1}}}),it=t.component({computed:{readOnly:function(){return e.isReadOnly(this.$editor)}}}),at=t.component({computed:{focused:function(){return et(this.$editor).focused}}}),st=function(){var t=o(w()),a=new _({data:{focused:!1,selected:{elements:[]}},methods:{updateSelected:function(){var t=this,r=i.get(this),o=r.selection;o&&this.selected.elements.forEach((function(i){var a=n.get(i);if(a){var s=a.id,c=e.findPath(r,i),u=C.range(r,c),l=E.intersection(u,o);t.$set(t.selected,s,!!l)}}))}}});return r.set(t,a),i.set(a,t),t},ct={install:function(t,e){t.mixin({beforeCreate:function(){this.$editor||(this.$options.components.Slate?(this.$editor=st(),(null==e?void 0:e.editorCreated)&&e.editorCreated.call(this,this.$editor)):this.$editor=this.$parent&&this.$parent.$editor)}}),t.use(T)}},ut=function(t,e,n){Object.defineProperty(t,e,{configurable:!0,get:function(){return n},set:function(t){console.warn("tried to set frozen property ".concat(e," with ").concat(t))}})},lt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object.defineProperty(t,e,{configurable:!0,writable:!0,value:n})},dt=t.component({abstract:!0,name:"Fragment",props:{name:{type:String,default:function(){return Math.floor(Date.now()*Math.random()).toString(16)}}},mounted:function(){var t=this.$el,e=t.parentNode,n=document.createComment("fragment#".concat(this.name,"#head")),r=document.createComment("fragment#".concat(this.name,"#tail"));e.insertBefore(n,t),e.insertBefore(r,t),t.appendChild=function(n){e.insertBefore(n,r),ut(n,"parentNode",t)},t.insertBefore=function(n,r){e.insertBefore(n,r),ut(n,"parentNode",t)},t.removeChild=function(t){e.removeChild(t),lt(t,"parentNode")},Array.from(t.childNodes).forEach((function(e){return t.appendChild(e)})),e.removeChild(t),ut(t,"parentNode",e),ut(t,"nextSibling",r.nextSibling),ut(r,"parentNode",t);var o=e.insertBefore;e.insertBefore=function(r,i){o.call(e,r,i!==t?i:n)};var i=e.removeChild;e.removeChild=function(a){if(a===t){for(;n.nextSibling!==r;)t.removeChild(n.nextSibling);e.removeChild(n),e.removeChild(r),lt(t,"parentNode"),e.insertBefore=o,e.removeChild=i}else i.call(e,a)}},render:function(t){var e=this.$slots.default;return t("div",{key:this.name},e)}}),ft=t.component({name:"slate",props:{value:String},components:{fragment:dt},data:function(){return{name:null}},created:function(){var t=this;this.renderSlate(),this.$editor.clear=function(){t.renderSlate(JSON.stringify([{children:[{text:""}]}]))}},watch:{value:function(t,e){t!==e&&this.renderSlate(t)}},methods:{genUid:function(){return Math.floor(Date.now()*Math.random()).toString(16)},renderSlate:function(t){var e=t||this.value,n=this.$editor;n.children=JSON.parse(e);var r=JSON.parse(e);n._state=_.observable(r),this.clearEditor(),this.name=this.genUid()},clearEditor:function(){this.$editor.selection=null}},render:function(){var t=this,n=arguments[0];return a.set(this.$editor,(function(){t.$editor._state.__ob__.dep.notify();var n=et(t.$editor);n.focused=e.isFocused(t.$editor);var r=t.$editor._operation;r&&"set_selection"===r.type&&n.updateSelected(),t.$emit("onChange",t.$editor._state)})),n(dt,{attrs:{name:this.name}},[this.$scopedSlots.default&&this.$scopedSlots.default({})])}}),ht=t.component({props:{text:String,isTrailing:Boolean},render:function(){var t=arguments[0],e=this.text,n=this.isTrailing,r=void 0!==n&&n;return t("span",{attrs:{"data-slate-string":!0}},[e,r?"\n":null])}}),pt={functional:!0,render:function(t,e){var n=e.props,r=n.length,o=void 0===r?0:r,i=n.isLineBreak,a=void 0!==i&&i;return t("span",{attrs:{"data-slate-zero-width":a?"n":"z","data-slate-length":o}},["\ufeff",a?t("br"):null])}},mt=t.component({props:{leaf:{type:Object},editor:Object},inject:["isLast","parent","text"],components:{TextString:ht},data:function(){return{}},render:function(){var t=arguments[0],n=this.leaf,r=this.editor,o=this.isLast,i=this.parent,a=this.text,s=e.findPath(r,a),c=x.parent(s);return r.isVoid(i)?t(pt,{attrs:{length:O.string(i).length}}):""!==n.text||i.children[i.children.length-1]!==a||r.isInline(i)||""!==C.string(r,c)?""===n.text?t(pt):o&&"\n"===n.text.slice(-1)?t(ht,{attrs:{isTrailing:!0,text:n.text}}):t(ht,{attrs:{text:n.text}}):t(pt,{attrs:{isLineBreak:!0}})}}),vt=t.component({props:{text:{type:Object},leaf:{type:Object}},inject:["renderLeaf"],components:{string:mt,fragment:dt},data:function(){return{}},render:function(t){var e=this.renderLeaf,n=void 0===e?gt:e,r=this.text,o=this.leaf,i=t(mt,{attrs:{text:r,editor:this.$editor,leaf:o}});o[s]&&(i=t(dt,[t("span",{attrs:{contenteditable:!1},style:{pointerEvents:"none",display:"inline-block",verticalAlign:"text-top",width:"0",maxWidth:"100%",whiteSpace:"nowrap",opacity:"0.333"}},[o.placeholder]),i]));return t(n({children:i,attributes:{"data-slate-leaf":!0},leaf:o,text:r}))}}),gt=function(e){return t.component({render:function(){var t=arguments[0],n=e.attributes,r=e.children;return t("span",{attrs:J({},n)},[r])}})},yt=t.component({props:{text:{type:Object},isLast:Boolean,parent:{type:Object},decorations:{type:Array}},components:{leaf:vt},inject:["decorate","placeholder"],provide:function(){return{text:this.text,isLast:this.isLast,parent:this.parent}},data:function(){return{ref:null}},hooks:function(){var t=this.ref=L(null),n=this.text,r=this.$editor,o=e.findKey(r,n);A((function(){t.current?(c.set(o,t.current),u.set(n,t.current),l.set(t.current,n)):(c.delete(o),u.delete(n))}))},render:function(t,n){var r=this.text,o=this.placeholder,i=this.decorations;if(!i){var a=this.$editor,c=e.findPath(a,r);if(this.decorate&&(i=this.decorate([r,c])),o&&1===a.children.length&&1===Array.from(O.texts(a)).length&&""===O.string(a)){var u,l=C.start(a,[]);i.push((I(u={},s,!0),I(u,"placeholder",o),I(u,"anchor",l),I(u,"focus",l),u))}}for(var d=$.decorations(r,i),f=[],h=0;h<d.length;h++){var p=d[h];f.push(t(vt,{attrs:{leaf:p}}))}return t("span",{attrs:{"data-slate-node":"text"},ref:this.ref.id},[f])}}),bt=t.component({props:{element:{type:Object}},inject:["readOnly","renderElement"],components:{Children:St},data:function(){return{ref:null}},mounted:function(){nt(this,"element")},hooks:function(){var t=this.ref=L(null),n=this.element,r=e.findKey(this.$editor,n);A((function(){t.current?(c.set(r,t.current),u.set(n,t.current),l.set(t.current,n)):(c.delete(r),u.delete(n))}))},render:function(t){var e=this.element,n=this.renderElement,r=void 0===n?_t:n,o=this.ref,i=this.$editor,a=i.isInline(e),s=t(St,{attrs:{node:e}}),c={"data-slate-node":"element"};if(a&&(c["data-slate-inline"]=!0),!a&&C.hasInlines(i,e)){var u=O.string(e),l=j(u);"rtl"===l&&(c.dir=l)}if(C.isVoid(i,e)){c["data-slate-void"]=!0,!this.readOnly&&a&&(c.contentEditable=!1);var h=a?"span":"div",p=K(O.texts(e),1),m=K(p[0],1)[0];s=this.readOnly?null:t(h,{attrs:{"data-slate-spacer":!0},style:{height:"0",color:"transparent",outline:"none",position:"absolute"}},[t(yt,{attrs:{decorations:[],isLast:!1,parent:e,text:m}})]),d.set(m,0),f.set(m,e)}return t(r({element:e,attributes:c,children:s}),{ref:o.id})}}),_t=function(e){return t.component({render:function(){var t=arguments[0],n=e.attributes,r=e.children,o=e.element,i=this.$editor,a=i.isInline(o)?"span":"div";return t(a,{attrs:J({},n),style:{position:"relative"}},[r])}})},St=t.component({props:{node:{type:Object}},components:{TextComponent:yt,ElementComponent:bt,fragment:dt},mixins:[rt],mounted:function(){nt(this,"children")},render:function(){for(var t=arguments[0],n=this.$editor,r=this.node,o=e.findPath(n,r),i=k.isElement(r)&&!n.isInline(r)&&C.hasInlines(n,r),a=[],s=C.isEditor(r)?r._state:r.children,c=null,u=0;u<s.length;u++){var l=s[u],p=e.findKey(n,l),m=o.concat(u);if(C.range(n,m),d.set(l,u),f.set(l,r),n._operation&&h.get(p)){var v=n._operation.path;if("split_node"===n._operation.type&&x.isSibling(m,v)&&!x.equals(m,v)&&!x.equals(m,x.next(v))){c=h.get(p),a.push(c);continue}if("merge_node"===n._operation.type){var g=x.parent(v);if(x.isSibling(m,g)&&!x.isParent(m,v)){c=h.get(p),a.push(c);continue}}if("remove_node"===n._operation.type&&x.isSibling(m,v)&&!x.equals(m,v)){c=h.get(p),a.push(c);continue}}k.isElement(l)?(c=t(bt,{attrs:{element:l},key:p.id}),a.push(c)):(c=t(yt,{attrs:{isLast:i&&u===s.length-1,parent:r,text:l},key:p.id}),a.push(c)),h.set(p,c)}return t(dt,[a])}}),$t=!(v||g),Ot=t.component({props:{autoFocus:Boolean,renderLeaf:Function,renderElement:Function,readOnly:Boolean,decorate:{type:Function,default:function(){return[]}},placeholder:String,spellCheck:Boolean,autoCorrect:String,autoCapitalize:String,onBeforeInput:{type:Function},onKeyDown:{type:Function},onClick:{type:Function},onCompositionEnd:{type:Function},onCompositionStart:{type:Function},onCut:{type:Function},onCopy:{type:Function},onDragOver:{type:Function},onDragStart:{type:Function},onDragStop:{type:Function},onPaste:{type:Function},onFocus:{type:Function},onBlur:{type:Function},onDrop:{type:Function}},components:{Children:St},mixins:[rt],provide:function(){return{renderLeaf:this.renderLeaf,renderElement:this.renderElement,decorate:this.decorate,readOnly:this.readOnly,placeholder:this.placeholder}},data:function(){return{latestElement:null,isComposing:!1,isUpdatingSelection:!1,ref:null}},methods:{_onClick:function(t){p.onClick(t,this.$editor,this)},onSelectionchange:function(){p.onSelectionchange(this.$editor,this)},_onBeforeInput:function(t){p.onBeforeInput(t,this.$editor,this)},_onCompositionEnd:function(t){p.onCompositionEnd(t,this.$editor,this)},_onCompositionStart:function(t){p.onCompositionStart(t,this.$editor,this)},_onKeyDown:function(t){p.onKeyDown(t,this.$editor,this)},_onFocus:function(t){p.onFocus(t,this.$editor,this)},_onBlur:function(t){p.onBlur(t,this.$editor,this)},_onCopy:function(t){p.onCopy(t,this.$editor,this)},_onPaste:function(t){p.onPaste(t,this.$editor,this)},_onCut:function(t){p.onCut(t,this.$editor,this)},_onDragOver:function(t){p.onDragOver(t,this.$editor,this)},_onDragStart:function(t){p.onDragStart(t,this.$editor,this)},_onDrop:function(t){p.onDrop(t,this.$editor,this)}},hooks:function(){var t=this,n=this.ref=L(null),r=this.$editor;m.set(r,this.readOnly);A((function(){return document.addEventListener("selectionchange",t.onSelectionchange),function(){document.removeEventListener("selectionchange",t.onSelectionchange)}})),A((function(){n.current?(y.set(r,n.current),u.set(r,n.current),l.set(n.current,r)):u.delete(r)})),A((function(){var n=r.selection,o=window.getSelection();if(!t.isComposing&&o&&e.isFocused(r)){var i="None"!==o.type;if(n||i){var a=y.get(r),s=!1;if(a.contains(o.anchorNode)&&a.contains(o.focusNode)&&(s=!0),!(i&&s&&n&&E.equals(e.toSlateRange(r,o),n))){var c=e.toDOMNode(r,r);t.isUpdatingSelection=!0;var u=n&&e.toDOMRange(r,n);u?(E.isBackward(n)?o.setBaseAndExtent(u.endContainer,u.endOffset,u.startContainer,u.startOffset):o.setBaseAndExtent(u.startContainer,u.startOffset,u.endContainer,u.endOffset),u.startContainer.parentElement):o.removeAllRanges(),setTimeout((function(){u&&v&&c.focus(),t.isUpdatingSelection=!1}))}}}})),A((function(){n.current&&t.autoFocus&&setTimeout((function(){n.current.focus()}),0)}),[t.autoFocus]),v&&A((function(){b(n.current,!0)}),[])},render:function(){var t=arguments[0],e=this.$editor,n=this.ref,r={click:this._onClick,keydown:this._onKeyDown,focus:this._onFocus,blur:this._onBlur,beforeinput:this._onBeforeInput,copy:this._onCopy,cut:this._onCut,compositionend:this._onCompositionEnd,compositionstart:this._onCompositionStart,dragover:this._onDragOver,dragstart:this._onDragStart,drop:this._onDrop,paste:this._onPaste},o={spellcheck:$t?this.spellCheck:void 0,autocorrect:$t?this.autoCorrect:void 0,autocapitalize:$t?this.autoCapitalize:void 0};return t("div",{attrs:J({"data-gramm":!1,role:this.readOnly?void 0:"textbox",contenteditable:!this.readOnly,"data-slate-editor":!0,"data-slate-node":"value"},o),ref:n.id,style:{outline:"none",whiteSpace:"pre-wrap",wordWrap:"break-word"},on:J({},r)},[t(St,{attrs:{node:e,selection:e.selection}})])}});export{Ot as Editable,at as FocusedMixin,it as ReadOnlyMixin,ot as SelectedMixin,ft as Slate,rt as SlateMixin,ct as SlatePlugin,X as Transforms,nt as elementWatcherPlugin,dt as fragment,et as getGvm,A as useEffect,L as useRef,tt as vueRuntime,Z as vueRuntimeFunc};
//# sourceMappingURL=index.es.js.map
